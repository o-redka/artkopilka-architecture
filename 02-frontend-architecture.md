# Artkopilka — Frontend на Laravel. Технічне завдання та план реалізації

---

## 1. Загальний опис проекту

Поточний сайт artkopilka.net.ua працює на OpenCart 2.3.0.2.3 з темою Cyberstore. Проект передбачає розділення на дві частини:

- **admin.artkopilka.net.ua** — поточний OpenCart-сайт, використовується виключно як адмін-панель для управління контентом, товарами, замовленнями.
- **artkopilka.net.ua** — новий фронтенд на Laravel, який працює з тією ж базою даних OpenCart (префікс `oc_`).

Laravel-додаток читає та записує дані безпосередньо в таблиці OpenCart, забезпечуючи повну сумісність із адмін-панеллю.

---

## 2. Розгортання dev-середовища

### 2.1. Системні вимоги

| Компонент    | Версія          |
|--------------|-----------------|
| PHP          | 8.2+            |
| MySQL        | 5.7+ / MariaDB  |
| Composer     | 2.x             |
| Node.js      | 20 LTS          |
| npm          | 10+             |
| Laravel      | 11.x            |

### 2.2. Локальне середовище

Варіанти розгортання:

- **MAMP** — поточне середовище, підходить для швидкого старту. Laravel-проект розміщується поруч із OpenCart і підключається до тієї ж БД.
- **Laravel Herd** (macOS) — рекомендований варіант для локальної розробки на Laravel.
- **Docker** — опціональний варіант для уніфікації середовищ між розробниками.

### 2.3. Початкове налаштування проекту

```
composer create-project laravel/laravel artkopilka
```

Файл `.env` — підключення до існуючої БД OpenCart:

```
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=artkopilka_db
DB_USERNAME=root
DB_PASSWORD=
DB_PREFIX=oc_
```

### 2.4. Конфігурація бази даних

OpenCart використовує префікс `oc_` для всіх таблиць. В Laravel необхідно:

- Створити Eloquent-моделі з явним зазначенням таблиць (`protected $table = 'oc_product'`).
- Не використовувати міграції для існуючих таблиць OpenCart.
- Додаткові Laravel-таблиці (кеш, сесії, черги) створювати з власним префіксом або без нього.

### 2.5. Фронтенд-стек

| Інструмент   | Призначення                     |
|--------------|---------------------------------|
| Vite         | Збірка ресурсів                 |
| Blade        | Шаблонізатор                    |
| Tailwind CSS | Утилітарні стилі (новий дизайн) |
| Alpine.js    | Легка реактивність у Blade      |
| Axios        | AJAX-запити                     |
| Swiper       | Слайдери та каруселі            |

### 2.6. Структура проекту

```
artkopilka/
  app/
    Http/Controllers/
      HomeController.php
      CategoryController.php
      ProductController.php
      BrandController.php
      SellerController.php
      SearchController.php
      BlogController.php
      PageController.php
      Auth/
        LoginController.php
        RegisterController.php
        PasswordResetController.php
      Account/
        ProfileController.php
        OrderController.php
        AddressController.php
    Models/
      OpenCart/
        Product.php
        Category.php
        Manufacturer.php
        Review.php
        Option.php
        Banner.php
        Information.php
        ...
    Services/
      CartService.php
      WishlistService.php
      CompareService.php
      FilterService.php
      SeoService.php
      ConstructorService.php
      CanvasCalculatorService.php
      BundleService.php
      OrderService.php
      CrmService.php
    Auth/
      OpenCartUserProvider.php
  resources/
    views/
      layouts/
        app.blade.php
      partials/
        header.blade.php
        footer.blade.php
        menu.blade.php
        breadcrumbs.blade.php
      home/
      category/
      product/
      brand/
      seller/
      search/
      blog/
      pages/
      auth/
      account/
    css/
    js/
  routes/
    web.php
```

---

## 3. Технічні вимоги

### 3.1. Збереження структури URL

Всі URL мають залишитися ідентичними поточним. Маршрутизація побудована на таблиці `oc_url_alias` (або `oc_seo_url`), яка зберігає відповідності `route <-> keyword`.

Laravel повинен:

- Реалізувати middleware або route-сервіс, який перехоплює вхідний URI та шукає відповідний запис у таблиці `oc_url_alias`.
- На основі знайденого `route` визначати контролер та параметри.
- Генерувати SEO-friendly URL через хелпер, який також читає `oc_url_alias`.

### 3.2. Багатомовність

| Параметр       | Значення                    |
|----------------|-----------------------------|
| Основна мова   | uk (українська)             |
| Додаткова мова | ru (російська)              |
| Формат URL     | `/uk/...` та `/ru/...`      |
| Зберігання     | Таблиці `*_description` OC  |

Реалізація:

- Route-група з префіксом `{locale}`, де locale = `uk` або `ru`.
- Middleware, що встановлює поточну мову додатку та визначає `language_id` для вибірки з таблиць OpenCart.
- Відповідність мов: `uk` = `language_id` з `oc_language` де `code = 'uk-ua'`, `ru` = `code = 'ru-ru'`.

### 3.3. Кешування

- Категорії, меню, банери — Redis або file-кеш з TTL та інвалідацією.
- Фільтри товарів — розширене кешування результатів фільтрації по ключу (category_id + filter_params).
- Головна сторінка — кеш блоків (слайдер, переваги, рекомендовані, новинки, бренди).

---

## 4. Опис розділів для перенесення

### 4.1. Шапка сайту (Header)

- Логотип, контактна інформація.
- Верхнє меню (посилання на статичні сторінки).
- Деревоподібне мега-меню категорій (на основі `oc_category` з вкладеністю).
- Пошук по сайту.
- Іконки: кошик, обране, порівняння, акаунт.
- Перемикач мов `uk / ru`.

### 4.2. Футер (Footer)

- Блоки посилань (інформаційні сторінки, категорії).
- Контактна інформація.
- Соціальні мережі.
- Копірайт.

### 4.3. Головна сторінка

| Блок                          | Джерело даних OC                         |
|-------------------------------|------------------------------------------|
| Основний слайдер зображень    | `oc_banner`, `oc_banner_image`           |
| Переваги                      | Модуль / статичний контент               |
| Додаткові банери              | `oc_banner`, `oc_banner_image`           |
| Рекомендовані товари          | Модуль `cyber_productany` / вибірка      |
| Рекомендовані по категоріям   | Групування товарів по категоріям         |
| Новинки                       | `oc_product`, сортування по `date_added` |
| Бренди (виробники)            | `oc_manufacturer`                        |
| Відгуки про магазин           | Модуль `cyber_reviews_store`             |

### 4.4. Категорія товарів

- Виведення списку підкатегорій (зображення, назва, кількість товарів).
- Фільтрація товарів — адаптація логіки MegaFilter (`ocfilter`), робота з таблицями `oc_ocfilter_option`, `oc_ocfilter_option_value` та пов'язаними. Розширене кешування результатів фільтрації.
- Два режими відображення: грід та лістинг (перемикання через UI, збереження у cookie/session).
- Сортування товарів (за назвою, ціною, рейтингом, датою).
- Ліміт товарів на сторінку (16 / 25 / 50).
- Пагінація (класична, з номерами сторінок).
- AJAX-підвантаження товарів (кнопка "Показати ще" або infinite scroll).
- SEO-опис категорії (з таблиці `oc_category_description`).
- Карточка товару в каталозі (зображення, назва, ціна, стара ціна, стікери, кнопки купити/обране/порівняння).
- Попап швидкого перегляду (модальне вікно з основною інформацією та кнопкою "Детальніше").

### 4.5. Карточка товару

- Основне зображення з можливістю збільшення (zoom).
- Галерея додаткових зображень (`oc_product_image`).
- Функціонал кнопок: Купити (додати до кошика), Додати в обране, Порівняти.
- Блок інформації про продавця (модуль `kbmp_marketplace`, якщо є прив'язка).
- Блок бренду / виробника (`oc_manufacturer`).
- Блок стікерів (`cyber_pro_sticker` — мітки: новинка, акція, хіт тощо).
- Блок варіантів вибору (`oc_product_option`, `oc_product_option_value`) — відображення у вигляді кнопок, випадаючих списків, кольорових свотчів залежно від типу опції.
- Таби:
  - Опис — `oc_product_description.description`.
  - Характеристики — `oc_product_attribute`.
  - Відгуки — `oc_review`, з формою додавання.
  - Питання та відповіді — модуль `cyber_question_answer`.
- Рекомендовані товари (`oc_product_related`).
- Відгуки про магазин (блок із модуля `cyber_reviews_store`).

### 4.6. Товар як комплект (Bundle)

Базується на модулі Bundle Expert. Логіка карточки товару зберігається, додатково:

- Відображення списку товарів, що входять у комплект.
- Ціна формується як сума цін складових товарів.
- Окремий шаблон сторінки (аналог `product_complect.tpl`).
- Джерело даних: таблиці модуля Bundle Expert (`oc_bundle_expert_*`).

### 4.7. Конструктор рам

Перенесення логіки з контролера `ControllerProductConstructor`:

- Фільтрація рам за параметрами: колір (`oc_constructor_color`), глибина (`oc_contsructor_depth`), скло (`oc_constructor_ram_glass`).
- AJAX-завантаження відфільтрованих товарів (метод `get_products()`).
- Форма вибору параметрів з динамічним оновленням результатів.
- Кастомна сторінка з власним шаблоном.
- Тригер: товари з SKU `cr-1`.

### 4.8. Калькулятор полотен

Перенесення логіки з шаблону `product_holst.tpl`:

- Калькулятор розміру полотна з вводом параметрів.
- Завантаження файлу зображення користувача.
- Розрахунок вартості на основі введених параметрів.
- Попередній перегляд результату.
- Тригер: товари з SKU `artokiplka-zakaz`.

### 4.9. Сторінка знижок

- Виведення товарів з активними акціями (`oc_product_special`).
- Фільтрація, сортування, пагінація (аналогічно категорії).
- Відображення старої та нової ціни, відсотка знижки.

### 4.10. Розділ "Бренди"

- Сторінка зі списком усіх брендів (`oc_manufacturer`).
- Сторінка окремого бренду з його товарами.
- Фільтрація, сортування, пагінація товарів бренду.

### 4.11. Розділ "Продавець"

- Профіль продавця (модуль `kbmp_marketplace`).
- Список товарів продавця з фільтрацією.
- Інформація про продавця, рейтинг, відгуки.

### 4.12. Розширений пошук

- Пошук по назві, опису, тегах, SKU.
- Автодоповнення в шапці (AJAX, модуль `cyber_autosearch`).
- Сторінка результатів пошуку з фільтрацією (аналогічно категорії).
- Пошук по категоріях, брендах.

### 4.13. Статичні сторінки

Верстка інформаційних сторінок на основі `oc_information`, `oc_information_description`:

- Про нас
- Доставка та оплата
- Купити в кредит
- Інші сторінки з адмін-панелі

### 4.14. Блог

- Категорії блогу.
- Список статей з пагінацією.
- Сторінка окремої статті.
- SEO-мета-теги для статей.

### 4.15. Кошик

- Сторінка кошика з переліком доданих товарів.
- Міні-кошик у шапці сайту (dropdown з переліком товарів, загальна сума, кнопка оформлення).
- Зміна кількості товару, видалення товару з кошика.
- Відображення обраних опцій товару (колір, розмір тощо).
- Автоматичний перерахунок суми при зміні кількості.
- Товари комплектів (Bundle) відображаються як єдина позиція з деталізацією складових.
- Застосування купонів та промокодів.
- Інформаційний блок з умовами доставки.
- Збереження стану кошика для авторизованих користувачів (таблиця `oc_cart`), для гостей — через сесію.
- AJAX-оновлення кошика без перезавантаження сторінки.

### 4.16. Оформлення замовлення

Оформлення замовлення розділене по продавцях (мультиселлер на основі `kbmp_marketplace`):

- Товари в чекауті групуються по продавцях. Кожна група формує окреме замовлення в БД.
- Крок 1: Контактні дані покупця (ім'я, телефон, email). Авторизація або оформлення як гість.
- Крок 2: Спосіб доставки. Для кожного продавця обирається окремо. Інтеграція з Новою Поштою (модуль `novaposhta`): вибір міста, відділення/поштомат.
- Крок 3: Спосіб оплати (на карту, накладений платіж, онлайн-оплата, кредит).
- Крок 4: Підтвердження замовлення. Відображення підсумку по кожному продавцю окремо: товари, вартість доставки, загальна сума.
- Створення окремого запису в `oc_order` для кожного продавця.
- Збереження позицій замовлення в `oc_order_product`, `oc_order_option`, `oc_order_total`.
- Сторінка подяки з номерами замовлень.
- Email-повідомлення покупцю та продавцям.
- Історія замовлень в особистому кабінеті користувача.

### 4.17. Інтеграція замовлень з CRM

- Відправка даних замовлення у CRM-систему при створенні замовлення (webhook або API-запит).
- Формат передачі: зберігаємо поточний формат.
- Реалізація через Laravel Events + Listeners: подія `OrderCreated` викликає listener, що формує та відправляє запит до CRM.
- Асинхронна відправка через Laravel Queues для уникнення затримок при оформленні.
- Логування всіх запитів до CRM (статус відправки, відповідь, помилки) в таблицю `crm_sync_log`.
- Механізм повторної відправки (retry) у разі недоступності CRM.
- Оновлення статусу замовлення в CRM при зміні статусу в адмін-панелі OpenCart (через спільну БД або окремий cron-процес, що відстежує зміни в `oc_order_history`).
- Конфігурація підключення до CRM через `.env` (URL, API-ключ, таймаути).

### 4.18. Авторизація та реєстрація

Авторизація працює з існуючою таблицею `oc_customer`. Оскільки OpenCart використовує власний формат хешування паролів, необхідний кастомний `UserProvider`.

- Реєстрація нового користувача: ім'я, прізвище, email, телефон, пароль. Запис у `oc_customer` з генерацією `salt` та хешу пароля у форматі OpenCart (`SHA1(salt + SHA1(salt + SHA1(password)))`).
- Авторизація за email + пароль через кастомний `OpenCartUserProvider`, який валідує хеш за алгоритмом OpenCart.
- Відновлення пароля: генерація токена, відправка email з посиланням на скидання.
- Підтвердження email при реєстрації (якщо увімкнено в налаштуваннях OC).
- Middleware `auth` для захищених маршрутів особистого кабінету.
- Збереження сесії авторизації, автоматичний logout по таймауту.
- Захист від brute-force: Laravel Rate Limiting на маршрутах авторизації.

### 4.19. Особистий кабінет користувача

Кабінет користувача побудований на даних з таблиць `oc_customer`, `oc_address`, `oc_order` та пов'язаних.

**Контактні дані:**

- Перегляд та редагування профілю: ім'я, прізвище, email, телефон (таблиця `oc_customer`).
- Зміна пароля (валідація старого пароля, генерація нового хешу у форматі OpenCart).
- Управління адресами доставки: додавання, редагування, видалення, вибір адреси за замовчуванням (таблиця `oc_address`).

**Історія замовлень:**

- Список усіх замовлень користувача з пагінацією (таблиця `oc_order`, фільтр по `customer_id`).
- Відображення: номер замовлення, дата, статус, кількість товарів, загальна сума.
- Детальна сторінка замовлення: перелік товарів з опціями, ціни, підсумки (`oc_order_product`, `oc_order_option`, `oc_order_total`).
- Інформація про доставку та оплату.
- Фільтрація замовлень за статусом та періодом.

**Зміна статусів замовлень:**

- Відображення поточного статусу замовлення (таблиця `oc_order_status`, поле `order_status_id` в `oc_order`).
- Хронологія змін статусу (таблиця `oc_order_history`): дата, статус, коментар.
- Можливість скасування замовлення покупцем (якщо статус дозволяє, наприклад, лише "Очікує" або "В обробці"). Скасування створює новий запис в `oc_order_history` та оновлює `order_status_id`.
- Синхронізація зміни статусу з CRM (через подію `OrderStatusChanged`).

**Додатково:**

- Список обраних товарів (wishlist) з таблиці `oc_customer_wishlist`.
- Список порівняння (session-based або `oc_customer` поле).
- Повторне замовлення: кнопка "Повторити замовлення" додає всі товари замовлення в кошик.

---

## 5. План реалізації

**Період: 23.02.2026 — 31.03.2026 (6 тижнів)**

### Тиждень 1: 23.02 — 01.03. Фундамент

| Завдання                                            | Дні  |
|-----------------------------------------------------|------|
| Розгортання Laravel-проекту, налаштування .env та БД | 0.5  |
| Eloquent-моделі для основних таблиць OpenCart        | 1    |
| Middleware: мультимовність (uk/ru з префіксом URL)   | 0.5  |
| Сервіс маршрутизації на основі `oc_url_alias`       | 1    |
| Базовий layout: header, footer, мега-меню            | 1.5  |
| Налаштування Vite, Tailwind CSS, Alpine.js           | 0.5  |

**Результат тижня:** Робочий скелет додатку з шапкою, футером, деревоподібним меню, перемикачем мов та SEO-маршрутизацією.

---

### Тиждень 2: 02.03 — 08.03. Головна сторінка та каталог

| Завдання                                                   | Дні  |
|------------------------------------------------------------|------|
| Головна сторінка: слайдер, переваги, банери                | 1    |
| Головна сторінка: рекомендовані, новинки, бренди, відгуки  | 1    |
| Категорія: список підкатегорій, виведення товарів          | 1    |
| Категорія: сортування, ліміт, пагінація, грід/лістинг     | 1    |
| Категорія: SEO-опис, карточка товару в каталозі            | 1    |

**Результат тижня:** Повністю працююча головна сторінка та базова сторінка категорії.

---

### Тиждень 3: 09.03 — 15.03. Фільтрація та карточка товару

| Завдання                                                    | Дні  |
|-------------------------------------------------------------|------|
| Фільтрація товарів (адаптація MegaFilter) + кешування       | 1.5  |
| AJAX-підвантаження товарів, попап швидкого перегляду         | 1    |
| Карточка товару: зображення, галерея, базова інформація      | 1    |
| Карточка товару: опції, стікери, бренд, продавець            | 1    |
| Карточка товару: таби (опис, характеристики, відгуки, Q&A)  | 0.5  |

**Результат тижня:** Повна фільтрація в каталозі, робоча карточка товару з усіма блоками.

---

### Тиждень 4: 16.03 — 22.03. Спеціальні модулі та e-commerce

| Завдання                                                          | Дні  |
|-------------------------------------------------------------------|------|
| Товар як комплект (Bundle Expert) — шаблон, логіка ціни            | 1    |
| Конструктор рам — перенесення логіки, AJAX-фільтрація              | 1    |
| Калькулятор полотен — перенесення логіки, завантаження файлів      | 1    |
| Кошик: сторінка кошика, міні-кошик, AJAX-оновлення                 | 1    |
| Обране та порівняння (сервіси + UI)                                | 0.5  |
| Розширений пошук + автодоповнення                                  | 0.5  |

**Результат тижня:** Всі спеціальні типи товарів працюють, кошик, обране, порівняння, пошук.

---

### Тиждень 5: 23.03 — 28.03. Чекаут, авторизація, кабінет

| Завдання                                                          | Дні  |
|-------------------------------------------------------------------|------|
| Авторизація та реєстрація: кастомний UserProvider, форми, захист   | 1    |
| Оформлення замовлення: контактні дані, вибір доставки та оплати    | 1    |
| Розділення замовлень по продавцях, створення записів в `oc_order`   | 1    |
| Кабінет: контактні дані, адреси, зміна пароля                      | 0.5  |
| Кабінет: історія замовлень, деталі замовлення, хронологія статусів | 1    |
| Інтеграція з CRM (Events, Queues, логування, retry)               | 0.5  |

**Результат тижня:** Повний цикл покупки з авторизацією, особистий кабінет з історією замовлень, CRM-інтеграція.

---

### Тиждень 6: 29.03 — 31.03 + резерв. Додаткові розділи, QA, деплой

| Завдання                                                          | Дні  |
|-------------------------------------------------------------------|------|
| Сторінка знижок                                                    | 0.5  |
| Розділ "Бренди" (список + сторінка бренду)                         | 0.5  |
| Розділ "Продавець" (профіль + товари з фільтрацією)                | 0.5  |
| Статичні сторінки (Про нас, Доставка, Оплата, Кредит)              | 0.5  |
| Категорія блогу + сторінка статті                                  | 1    |
| Кросбраузерне тестування, адаптивність, виправлення багів           | 1.5  |
| Налаштування production-середовища, деплой на сервер                | 1    |
| Тестування чекауту, кабінету та CRM на staging                     | 0.5  |
| Редиректи зі старих URL (якщо є зміни), перевірка SEO              | 0.5  |
| Перемикання DNS artkopilka.net.ua на Laravel                        | 0.5  |

**Результат тижня:** Всі розділи зверстані, протестовані, сайт задеплоєний на production.

---

## 6. Розгортання на production

### 6.1. Серверні вимоги

- PHP 8.2+ з розширеннями: mbstring, openssl, pdo_mysql, tokenizer, xml, ctype, json, bcmath, gd.
- MySQL 5.7+ (та ж сама БД, що й OpenCart).
- Nginx або Apache з mod_rewrite.
- Composer, Node.js (для збірки ресурсів).
- SSL-сертифікат.

### 6.2. Схема деплою

```
artkopilka.net.ua        ->  Laravel (новий фронтенд)
admin.artkopilka.net.ua  ->  OpenCart (адмін-панель)
                    |              |
                    +----- MySQL --+
                      (спільна БД)
```

### 6.3. Етапи деплою

1. Налаштування віртуальних хостів: `artkopilka.net.ua` вказує на `public/` Laravel, `admin.artkopilka.net.ua` — на корінь OpenCart.
2. Збірка фронтенду: `npm run build`.
3. Оптимізація Laravel: `php artisan config:cache`, `php artisan route:cache`, `php artisan view:cache`.
4. Налаштування cron для Laravel scheduler (якщо потрібен).
5. Тестування на staging перед переключенням DNS.

---

## 7. Ризики та обмеження

| Ризик                                        | Мітігація                                                   |
|----------------------------------------------|-------------------------------------------------------------|
| Несумісність структури БД між OC та Laravel  | Ретельне маппінг-тестування моделей на початку проекту       |
| Складність перенесення MegaFilter            | Спрощена реалізація фільтрації з поступовим розширенням      |
| Зміни в адмін-панелі ламають фронтенд       | Документування залежностей, версіонування моделей            |
| Стислі терміни (5 тижнів)                    | Пріоритизація: спершу ключові сторінки, потім додаткові      |
| Різниця хешування паролів OC vs Laravel      | Кастомний UserProvider для авторизації через хеші OpenCart    |

---

## 8. Критерії завершення

- Всі перелічені розділи зверстані у новому дизайні та функціонують.
- URL-структура збережена, редиректи налаштовані.
- Багатомовність працює коректно (uk/ru).
- Фільтрація, пошук, пагінація працюють без помилок.
- Повний цикл покупки працює: додавання в кошик, оформлення замовлення, розділення по продавцях.
- Авторизація та реєстрація працюють коректно з існуючою базою користувачів OpenCart.
- Особистий кабінет: профіль, адреси, історія замовлень, хронологія статусів.
- Замовлення коректно передаються в CRM, логування та retry працюють.
- Сайт адаптивний (mobile, tablet, desktop).
- Час завантаження головної сторінки не перевищує 2 секунди.
- Адмін-панель на admin.artkopilka.net.ua працює незалежно.
